from flask import Flask, render_template_string, request

app = Flask(__name__)

promotion_rules = {
    1: {
        2: (2, 1), 3: (2, 1), 4: (2, 2), 5: (2, 3), 6: (2, 4), 7: (2, 5),
        8: (2, 5), 9: (2, 6), 10: (2, 7), 11: (2, 8), 12: (2, 9),
        13: (2, 10), 14: (2, 10), 15: (2, 11)
    },
    2: {
        2: (3, 1), 3: (3, 1), 4: (3, 2), 5: (3, 3), 6: (3, 4), 7: (3, 5),
        8: (3, 6), 9: (3, 7), 10: (3, 7), 11: (3, 8), 12: (3, 9),
        13: (3, 10), 14: (3, 11), 15: (3, 12)
    },
    3: {
        2: (4, 1), 3: (4, 1), 4: (4, 2), 5: (4, 3), 6: (4, 4), 7: (4, 5),
        8: (4, 6), 9: (4, 6), 10: (4, 7), 11: (4, 8), 12: (4, 9),
        13: (4, 10), 14: (4, 11), 15: (4, 11)
    },
    4: {
        2: (5, 1), 3: (5, 1), 4: (5, 2), 5: (5, 3), 6: (5, 4), 7: (5, 5),
        8: (5, 6), 9: (5, 7), 10: (5, 7), 11: (5, 8), 12: (5, 9),
        13: (5, 10), 14: (5, 11), 15: (5, 12)
    },
    5: {
        2: (6, 1), 3: (6, 1), 4: (6, 2), 5: (6, 3), 6: (6, 4), 7: (6, 5),
        8: (6, 6), 9: (6, 7), 10: (6, 7), 11: (6, 8), 12: (6, 9),
        13: (6, 10), 14: (6, 11), 15: (6, 12)
    },
    6: {
        2: (7, 1), 3: (7, 1), 4: (7, 2), 5: (7, 3), 6: (7, 4), 7: (7, 5),
        8: (7, 6), 9: (7, 6), 10: (7, 7), 11: (7, 8), 12: (7, 9),
        13: (7, 10), 14: (7, 11), 15: (7, 11)
    },
    7: {
        2: (8, 1), 3: (8, 2), 4: (8, 3), 5: (8, 3), 6: (8, 4), 7: (8, 5),
        8: (8, 6), 9: (8, 7), 10: (8, 8), 11: (8, 9), 12: (8, 10),
        13: (8, 11), 14: (8, 11), 15: (8, 12)
    },
    8: {
        2: (9, 1), 3: (9, 1), 4: (9, 2), 5: (9, 3), 6: (9, 4), 7: (9, 5),
        8: (9, 6), 9: (9, 7), 10: (9, 8), 11: (9, 9), 12: (9, 9),
        13: (9, 10), 14: (9, 11), 15: (9, 12)
    },
    9: {
        2: (10, 1), 3: (10, 2), 4: (10, 3), 5: (10, 4), 6: (10, 5), 7: (10, 6),
        8: (10, 7), 9: (10, 8), 10: (10, 9), 11: (10, 10), 12: (10, 11),
        13: (10, 12), 14: (10, 12), 15: (10, 13)
    },
    10: {
        2: (11, 1), 3: (11, 1), 4: (11, 2), 5: (11, 3), 6: (11, 4), 7: (11, 5),
        8: (11, 6), 9: (11, 7), 10: (11, 8), 11: (11, 9), 12: (11, 10),
        13: (11, 11), 14: (11, 12), 15: (11, 13)
    },
    11: {
        2: (12, 1), 3: (12, 1), 4: (12, 2), 5: (12, 3), 6: (12, 4), 7: (12, 5),
        8: (12, 6), 9: (12, 7), 10: (12, 8), 11: (12, 9), 12: (12, 10),
        13: (12, 11), 14: (12, 12)
    },
    12: {
        2: (13, 1), 3: (13, 1), 4: (13, 2), 5: (13, 3), 6: (13, 4), 7: (13, 5),
        8: (13, 6), 9: (13, 7), 10: (13, 8), 11: (13, 9), 12: (13, 10),
        13: (13, 11)
    },
    13: {
        2: (14, 1), 3: (14, 1), 4: (14, 2), 5: (14, 3), 6: (14, 4), 7: (14, 5),
        8: (14, 6), 9: (14, 7), 10: (14, 8), 11: (14, 8), 12: (14, 9)
    },
    14: {
        2: (15, 1), 3: (15, 1), 4: (15, 1), 5: (15, 1), 6: (15, 2), 7: (15, 3),
        8: (15, 4), 9: (15, 4), 10: (15, 5), 11: (15, 6)
    }
}

promotion_salary = {
    (1, 1): 3000, (2, 1): 3430, (3, 1): 3945, (4, 1): 4530, (5, 1): 5240, (6, 1): 6065, (7, 1): 7010, (8, 1): 8010, (9, 1): 9275, (10, 1): 10275, (11, 1): 11815, (12, 1): 13435, (13, 1): 15180, (14, 1): 17015, (15, 1): 20855,
    (1, 2): 3135, (2, 2): 3595, (3, 2): 4135, (4, 2): 4760, (5, 2): 5505, (6, 2): 6370, (7, 2): 7375, (8, 2): 8425, (9, 2): 9745, (10, 2): 10785, (11, 2): 12345, (12, 2): 14005, (13, 2): 15785, (14, 2): 17715, (15, 2): 21720,
    (1, 3): 3270, (2, 3): 3760, (3, 3): 4325, (4, 3): 4990, (5, 3): 5770, (6, 3): 6675, (7, 3): 7740, (8, 3): 8840, (9, 3): 10215, (10, 3): 11295, (11, 3): 12875, (12, 3): 14575, (13, 3): 16390, (14, 3): 18415, (15, 3): 22585,
    (1, 4): 3405, (2, 4): 3925, (3, 4): 4515, (4, 4): 5220, (5, 4): 6035, (6, 4): 6980, (7, 4): 8105, (8, 4): 9255, (9, 4): 10685, (10, 4): 11805, (11, 4): 13405, (12, 4): 15145, (13, 4): 16995, (14, 4): 19115, (15, 4): 23450,
    (1, 5): 3540, (2, 5): 4090, (3, 5): 4705, (4, 5): 5450, (5, 5): 6300, (6, 5): 7285, (7, 5): 8470, (8, 5): 9670, (9, 5): 11155, (10, 5): 12315, (11, 5): 13935, (12, 5): 15715, (13, 5): 17600, (14, 5): 19815, (15, 5): 24315,
    (1, 6): 3675, (2, 6): 4255, (3, 6): 4895, (4, 6): 5680, (5, 6): 6565, (6, 6): 7590, (7, 6): 8835, (8, 6): 10085, (9, 6): 11625, (10, 6): 12825, (11, 6): 14465, (12, 6): 16285, (13, 6): 18205, (14, 6): 20515, (15, 6): 25180,
    (1, 7): 3810, (2, 7): 4420, (3, 7): 5085, (4, 7): 5910, (5, 7): 6830, (6, 7): 7895, (7, 7): 9200, (8, 7): 10500, (9, 7): 12095, (10, 7): 13335, (11, 7): 14995, (12, 7): 16855, (13, 7): 18810, (14, 7): 21215, (15, 7): 26045,
    (1, 8): 3945, (2, 8): 4585, (3, 8): 5275, (4, 8): 6140, (5, 8): 7095, (6, 8): 8200, (7, 8): 9565, (8, 8): 10915, (9, 8): 12565, (10, 8): 13845, (11, 8): 15525, (12, 8): 17425, (13, 8): 19415, (14, 8): 21915, (15, 8): 26910,
    (1, 9): 4080, (2, 9): 4750, (3, 9): 5465, (4, 9): 6370, (5, 9): 7360, (6, 9): 8505, (7, 9): 9930, (8, 9): 11330, (9, 9): 13035, (10, 9): 14355, (11, 9): 16055, (12, 9): 17995, (13, 9): 20020, (14, 9): 22615, (15, 9): 27775,
    (1, 10): 4215, (2, 10): 4915, (3, 10): 5655, (4, 10): 6600, (5, 10): 7625, (6, 10): 8810, (7, 10): 10295, (8, 10): 11745, (9, 10): 13505, (10, 10): 14865, (11, 10): 16585, (12, 10): 18565, (13, 10): 20625, (14, 10): 23315, (15, 10): 28640,
    (1, 11): 4350, (2, 11): 5080, (3, 11): 5845, (4, 11): 6830, (5, 11): 7890, (6, 11): 9115, (7, 11): 10660, (8, 11): 12160, (9, 11): 13975, (10, 11): 15375, (11, 11): 17115, (12, 11): 19135, (13, 11): 21230, (14, 11): 24015,
    (1, 12): 4485, (2, 12): 5245, (3, 12): 6035, (4, 12): 7060, (5, 12): 8155, (6, 12): 9420, (7, 12): 11025, (8, 12): 12575, (9, 12): 14445, (10, 12): 15885, (11, 12): 17645, (12, 12): 19705, (13, 12): 21835,
    (1, 13): 4620, (2, 13): 5410, (3, 13): 6225, (4, 13): 7290, (5, 13): 8420, (6, 13): 9725, (7, 13): 11390, (8, 13): 12990, (9, 13): 14915, (10, 13): 16395, (11, 13): 18175, (12, 13): 20275,
    (1, 14): 4755, (2, 14): 5575, (3, 14): 6415, (4, 14): 7520, (5, 14): 8685, (6, 14): 10030, (7, 14): 11755, (8, 14): 13405, (9, 14): 15385, (10, 14): 16905, (11, 14): 18705,
    (1, 15): 4890, (2, 15): 5740, (3, 15): 6605, (4, 15): 7750, (5, 15): 8950, (6, 15): 10335, (7, 15): 12120, (8, 15): 13820, (9, 15): 15855, (10, 15): 17415,
}

HTML_TEMPLATE = """<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>حاسبة الترقية - الخدمة المدنية</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <style>
        body { background: #f8fafc; font-family: 'Tajawal', Arial, sans-serif; }
        .card { margin-top: 40px; border-radius: 18px; box-shadow: 0 2px 12px #0001; }
        .form-label { font-weight: bold; }
        .result { font-size: 1.3rem; color: #0d6efd; }
        .btn-custom { background: linear-gradient(90deg, #0d6efd 60%, #0dcaf0 100%); color: #fff; }
        .btn-custom:hover { background: #0d6efd; }
        .header-card {
            margin-top: 30px;
            margin-bottom: 10px;
            border-radius: 16px;
            background: linear-gradient(90deg, #0d6efd 60%, #0dcaf0 100%);
            color: #fff;
            box-shadow: 0 2px 12px #0001;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            padding: 10px 0 8px 0;
            /* متناسق أكثر مع التصميم */
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="header-card">
                الادارة العامة للموارد البشرية
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card p-4">
                <h2 class="mb-4 text-center">حاسبة الترقية الوظيفية</h2>
                <form method="post">
                    <div class="mb-3">
                        <label for="rank" class="form-label">المرتبة الحالية</label>
                        <select class="form-select" id="rank" name="rank" required>
                            <option value="">اختر المرتبة</option>
                            {% for i in range(1, 15) %}
                                <option value="{{i}}" {% if rank==i %}selected{% endif %}>{{i}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="grade" class="form-label">الدرجة الحالية</label>
                        <select class="form-select" id="grade" name="grade" required>
                            <option value="">اختر الدرجة</option>
                            {% for i in range(1, 16) %}
                                <option value="{{i}}" {% if grade==i %}selected{% endif %}>{{i}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="d-flex justify-content-between">
                        <button type="submit" class="btn btn-custom px-4">احسب الترقية</button>
                        <a href="/" class="btn btn-outline-secondary">إعادة التحديد</a>
                    </div>
                </form>
                {% if result %}
                    <div class="alert alert-info mt-4 result text-center">
                        <span>المرتبة الجديدة: <b>{{result[0]}}</b> | الدرجة الجديدة: <b>{{result[1]}}</b></span>
                    </div>
                    <div class="alert alert-secondary mt-2 text-center" style="font-size:1.1rem;">
                        <span>راتب المرتبة الحالية: <b>{{current_salary}}</b> ريال</span><br>
                        <span>راتب المرتبة الجديدة: <b>{{new_salary}}</b> ريال</span><br>
                        {% if salary_diff is not none %}
                            <span style="color:green;">زيادة الراتب بعد الترقية: <b>{{salary_diff}}</b> ريال</span>
                        {% endif %}
                    </div>
                {% elif error %}
                    <div class="alert alert-danger mt-4 text-center">{{error}}</div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
</body>
</html>
"""

@app.route("/", methods=["GET", "POST"])
def index():
    result = None
    error = None
    rank = None
    grade = None
    current_salary = None
    new_salary = None
    salary_diff = None

    if request.method == "POST":
        try:
            rank = int(request.form["rank"])
            grade = int(request.form["grade"])
            if rank in promotion_rules and grade in promotion_rules[rank]:
                result = promotion_rules[rank][grade]
                current_salary = promotion_salary.get((rank, grade))
                new_salary = promotion_salary.get(result)
                if current_salary is not None and new_salary is not None:
                    salary_diff = new_salary - current_salary
            else:
                error = "لا يوجد شرط ترقية مطابق للمدخلات."
        except Exception:
            error = "يرجى إدخال بيانات صحيحة."
    return render_template_string(
        HTML_TEMPLATE,
        result=result,
        error=error,
        rank=rank,
        grade=grade,
        current_salary=current_salary,
        new_salary=new_salary,
        salary_diff=salary_diff
    )

if __name__ == "__main__":
    import webbrowser
    import threading
    import sys
    import os

    def open_browser():
        # فتح المتصفح تلقائياً بعد تشغيل السيرفر
        webbrowser.open_new("http://127.0.0.1:5001/")

    # يعمل على ويندوز وماك تلقائياً
    threading.Timer(1.0, open_browser).start()
    app.run(debug=True, host="127.0.0.1", port=5001)

# لتشغيل التطبيق:
# 1. افتح الطرفية (Terminal أو CMD).
# 2. انتقل إلى مجلد الملف:
#    cd /Users/mac/Desktop/sa
# 3. شغل التطبيق بالأمر:
#    python hrtr1_fixed.py
# 4. سيفتح المتصفح تلقائياً على العنوان:
#    http://127.0.0.1:5001/
# إذا لم يفتح المتصفح تلقائياً، يمكنك نسخه ولصقه يدوياً.
# يجب أن يكون لديك بايثون وflask مثبتين (pip install flask).
